import{u as R,j as e,S as L,a as U,A as y,m as h,s as p,b as $}from"./supabaseClient.JcG5vpDm.js";import{u as D,S as F}from"./StarRating.DUbRVut4.js";import{r as t}from"./index.D0mNDFPE.js";import"./chunk-XL46KY3Q.yPoBHZKd.js";import"./preload-helper.BlTxHScW.js";function O(){const{user:n}=R(),[u,w]=t.useState(""),[c,N]=t.useState(null),{open:S,SignInModal:_}=D("/misburgers"),[i,b]=t.useState([]),[k,B]=t.useState(!0),[f,C]=t.useState(""),[M,T]=t.useState([]),[j,d]=t.useState(null),[m,A]=t.useState([]),[x,q]=t.useState(0);t.useEffect(()=>{if(!n)return;async function s(){const{data:r,error:l}=await p.from("hamburguesas_probadas").select("puntuacion, hamburguesas(*, hamburguesa_alergenos(alergenos(nombre, icono_url)))").eq("usuario_id",n.id);if(r){b(r);const g=r.flatMap(o=>o.hamburguesas.hamburguesa_alergenos||[]).map(o=>o.alergenos).filter((o,P,I)=>o?.nombre&&I.findIndex(Q=>Q.nombre===o.nombre)===P);T(g)}B(!1)}async function a(){const{count:r}=await p.from("hamburguesas").select("*",{count:"exact",head:!0});r!==null&&q(r)}s(),a()},[n]);async function E(s){if(!n)return;const{error:a}=await p.from("hamburguesas_probadas").delete().eq("usuario_id",n.id).eq("hamburguesa_id",s);a?console.error("Error al desmarcar burger:",a):(b(r=>r.filter(l=>l.hamburguesas.id!==s)),d(null))}const v=i.filter(s=>{const a=s.hamburguesas.nombre.toLowerCase().includes(f.toLowerCase()),r=m.length===0||(s.hamburguesas.hamburguesa_alergenos||[]).some(g=>m.includes(g.alergenos.nombre)),l=c===null||s.puntuacion===c;return a&&r&&l}).sort((s,a)=>u==="mas-alta"?(a.puntuacion??0)-(s.puntuacion??0):u==="mas-baja"?(s.puntuacion??0)-(a.puntuacion??0):0);return e.jsxs(e.Fragment,{children:[e.jsx(L,{children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"¡Ups! Debes iniciar sesión para ver tus hamburguesas 🍔"}),e.jsx("button",{onClick:S,className:"mt-4 bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700",children:"Iniciar sesión ahora"})]})}),e.jsx(_,{}),e.jsxs(U,{children:[e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"🍔 Mis hamburguesas degustadas"}),e.jsxs("p",{className:"text-center text-lg text-gray-700 max-w-2xl mx-auto mt-6 leading-relaxed",children:["Estas son las burgers que ya has disfrutado.",e.jsx("br",{}),"¿Quieres cambiar alguna nota o seguir sumando nuevas experiencias?",e.jsx("br",{}),e.jsx("span",{className:"italic text-purple-600 font-medium",children:"Tú mandas en tu paladar. 😋"})]}),i.length===0?e.jsxs("div",{className:"text-center mt-8 text-lg text-gray-600",children:["🍔 ",e.jsx("strong",{children:"¡Empieza a disfrutar!"}),e.jsx("br",{}),"Aún no has probado ninguna burger. Ve a la carta y marca tus favoritas para llevar el control."]}):i.length===x?e.jsxs("div",{className:"text-center mt-8 text-lg text-gray-700",children:["🏆 ",e.jsx("strong",{children:"¡Te las has comido todas!"}),e.jsx("br",{}),"¿Quieres nuevos retos?",e.jsx("br",{}),e.jsx("span",{className:"italic text-purple-600",children:"Muy pronto tendremos una sorpresa para ti..."})]}):e.jsxs("div",{className:"text-center mt-4 text-sm text-gray-600",children:["Has probado ",e.jsx("strong",{children:i.length})," de ",e.jsx("strong",{children:x})," hamburguesas disponibles.",e.jsx("br",{}),"¡Te faltan solo ",x-i.length,"! 🍽️"]}),e.jsx("div",{className:"relative max-w-md mx-auto mb-6",children:e.jsx("input",{type:"text",placeholder:"🔍 Buscar por nombre...",className:"border border-gray-300 mt-8 rounded-full px-4 py-2 w-full shadow-sm focus:ring-2 focus:ring-purple-500 focus:outline-none",value:f,onChange:s=>C(s.target.value)})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-center gap-4 mb-6 text-sm text-gray-800",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[e.jsx("label",{className:"font-medium whitespace-nowrap",children:"Ordenar por:"}),e.jsxs("select",{value:u,onChange:s=>w(s.target.value),className:"bg-white border border-purple-300 text-gray-800 text-sm rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 block px-4 py-2 transition shadow-sm hover:shadow-md cursor-pointer",children:[e.jsx("option",{value:"",children:"--"}),e.jsx("option",{value:"mas-alta",children:"⭐ Más alta"}),e.jsx("option",{value:"mas-baja",children:"⭐ Más baja"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[e.jsx("label",{className:"font-medium whitespace-nowrap",children:"Filtrar puntuación:"}),e.jsxs("select",{value:c??"",onChange:s=>N(s.target.value===""?null:Number(s.target.value)),className:"bg-white border border-purple-300 text-gray-800 text-sm rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 block px-4 py-2 transition shadow-sm hover:shadow-md cursor-pointer",children:[e.jsx("option",{value:"",children:"Todas"}),[5,4,3,2,1].map(s=>e.jsx("option",{value:s,children:`⭐ ${s}`},s))]})]})]}),e.jsx("div",{className:"mb-6 flex flex-wrap gap-3",children:M.map(s=>{const a=m.includes(s.nombre);return e.jsxs("button",{onClick:()=>A(r=>a?r.filter(l=>l!==s.nombre):[...r,s.nombre]),className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs shadow-sm transition-transform duration-200 hover:scale-105 hover:brightness-110 ${a?"bg-purple-600 text-white":"bg-yellow-100 text-gray-800"}`,children:[s.icono_url&&e.jsx("img",{src:s.icono_url,alt:s.nombre,className:"w-3.5 h-3.5 object-contain"}),s.nombre]},s.nombre)})}),k?e.jsx("p",{children:"Cargando tus burgers..."}):v.length===0?e.jsx("p",{children:"No hay burgers que coincidan con tu búsqueda 😢"}):e.jsx("ul",{className:"flex flex-col space-y-8",children:e.jsx(y,{mode:"popLayout",children:v.map(s=>e.jsxs(h.li,{layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.25},className:"relative group flex flex-col md:flex-row items-center justify-between bg-white rounded-2xl shadow-md p-6 gap-4 md:gap-8",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-lg group w-full md:w-48 flex-shrink-0",children:[e.jsx("img",{src:s.hamburguesas.imagen_url,alt:s.hamburguesas.nombre,className:"w-full h-32 object-cover transform transition-transform duration-300 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition duration-300"}),e.jsx("a",{href:`/burgers/${s.hamburguesas.id}`,className:"whitespace-nowrap absolute bottom-4 left-1/2 transform -translate-x-1/2 translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 bg-black text-white text-sm py-2 px-6 rounded-full transition-all duration-300",children:"Ver detalles"})]}),e.jsx("div",{className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(h.button,{whileHover:{scale:1.2},whileTap:{scale:.95},onClick:()=>d(s.hamburguesas.id),className:"text-red-500 hover:text-red-700 text-xl transition-colors duration-200",title:"Quitar de favoritos",children:"🗑️"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h2",{className:"text-xl font-bold text-purple-800",children:s.hamburguesas.nombre}),e.jsx("p",{className:"text-gray-700 mt-1 line-clamp-3",children:s.hamburguesas.descripcion||"No hay descripción disponible..."})]}),e.jsxs("div",{className:"flex flex-col items-center md:items-end gap-2 w-full md:w-64",children:[e.jsx(y,{mode:"wait",children:e.jsxs(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"text-center",children:[e.jsx(F,{burgerId:s.hamburguesas.id,usuarioId:n?.id,initialRating:s.puntuacion,onRated:a=>handleRatingUpdate(s.hamburguesas.id,a)}),s.puntuacion===null&&e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"¿Quieres puntuarla? Solo tienes que hacer clic en las estrellas ⭐"})]},`rating-${s.hamburguesas.id}`)}),s.hamburguesas.hamburguesa_alergenos?.length>0&&e.jsx("div",{className:"flex flex-wrap justify-center md:justify-end gap-2 mt-2",children:s.hamburguesas.hamburguesa_alergenos.map(a=>e.jsx("div",{title:a.alergenos.nombre,className:"bg-yellow-100 px-2 py-1 rounded-full text-xs flex items-center gap-1 shadow-sm transition-transform duration-200 hover:scale-105 hover:brightness-110",children:a.alergenos.icono_url&&e.jsx("img",{src:a.alergenos.icono_url,alt:a.alergenos.nombre,className:"w-3.5 h-3.5 object-contain"})},a.alergenos.nombre))})]})]},s.hamburguesas.id))})})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg max-w-sm w-full text-center space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"¿Estás seguro?"}),e.jsx("p",{className:"text-sm text-gray-600",children:"¿Quieres quitar esta burger de tus favoritos?"}),e.jsxs("div",{className:"flex justify-center gap-4 pt-4",children:[e.jsx("button",{onClick:()=>d(null),className:"px-4 py-2 rounded bg-gray-200 hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{onClick:()=>E(j),className:"px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700",children:"Quitar"})]})]})})]})]})}function z(){return e.jsx("div",{className:"w-full px-4",children:e.jsx(O,{})})}function K(){return e.jsx($,{children:e.jsx(z,{})})}export{K as default};
